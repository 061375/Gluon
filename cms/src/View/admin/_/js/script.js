var Admin=function(){"use strict";var a=$(".button"),b=function(){a.on("click",c)},c=function(){$(this).hasClass("nav")&&$(this).closest("nav").toggleClass("hide"),$(this).hasClass("aside")&&$(this).closest("aside").toggleClass("hide"),$(this).find("div").toggleClass("arrow")},d=function(){b()};return{init:d}}(),Ajax=function(){"use strict";var a,b=!1,c=!1,d=function(b,c,d){"undefined"==typeof d&&(d=a),$.logThis("send ajax "+d);var e={method:b,data:c};return $.ajax({url:d,data:e,type:"post",dataType:"json"})},e=function(a,b,c){a.done(function(a){if(1==a.success)"function"==typeof b&&b(a);else if("undefined"!=typeof a.errors){var d="";$.each(a.errors,function(a,b){d+=b+"\n"}),"function"==typeof c?c(d):alert("An error occured "+d)}else c(a.message)}),a.fail(function(a,b,c){var d="An Error occurred...";"undefined"!=typeof a&&$.logThis("xhr error "+a.status),"undefined"!=typeof c&&$.logThis("thrownError "+c),alert(d)})},f=function(a){$.logThis("Ajax::get_session_url");for(var b="",f=0;10>f;f++){var g=98+Math.floor(15*Math.random());b+=String.fromCharCode(g)}var h=ajaxpath+b+".init",i=d("create_session_url",{},h);e(i,function(b){"undefined"!=typeof b.message&&(c=b.message,"function"==typeof a&&a(c))})},g=function(a){$.logThis("Ajax::init_session");var f=ajaxpath+c+".s",g=d("create_session",{},f);e(g,function(c){"undefined"!=typeof c.message&&"function"==typeof a&&(b=c.message,a())})},h=function(){return $.logThis("Ajax::return_session_url"),c},i=function(){return $.logThis("Ajax::return_session"),b},j=function(b){$.logThis("Ajax::init"),"function"==typeof b?f(b):a=b};return{init:j,init_session:g,return_session:i,return_session_url:h,getData:d,dataResult:e}}(),Install=function(){"use strict";var a,b,c=$(".startb"),d=$(".next-step"),e=$(".prev-step"),f=$(".run-install"),g=!1,h=function(){var a=$(this);a.css("display","none"),$(".box").addClass("start"),setTimeout(function(){$(".box").addClass("startb"),setTimeout(function(){a.parent().css("display","none"),a.parent().next().css("display","block")},100)},1e3)},i=function(){var a=$(this),b=!0;$(this).parent().find("input,select",function(){$(this).hasClass("required")&&(""==$(this).val()?(b=!1,$(this).prev().css("display","block")):$(this).prev().css("display","none"))}),$(".box").hasClass("startb")?$(".box").removeClass("startb"):$(".box").addClass("startb"),setTimeout(function(){a.parent().css("display","none"),a.parent().next().css("display","block")},100)},j=function(){var a=$(this);$(".box").hasClass("startb")?$(".box").removeClass("startb"):$(".box").addClass("startb"),setTimeout(function(){a.parent().css("display","none"),a.parent().prev().css("display","block")},100)},k=function(){$(".running .prev-step").css("display","none"),g=!1,$(".install-pro").html("");var c=!1;return a=0,b=$(this).parent(),$("input").each(function(){$(this).hasClass("required")&&""==$(this).val()?(c=!0,$(this).prev().css("display","block")):$(this).prev().css("display","none")}),c?!1:void b.fadeOut("fast",function(){$(".running").fadeIn("fast",function(){$.logThis("Likes::runinstall");var a=m($(".step.two"));n("Checking database connection...","install_database",a,function(){a=m($(".step.three")),n("Testing FTP connection...","add_ftp",a,function(){a=m($(".step.one")),n("Adding admin user...","add_user",a,function(){n("Finalizing Install...","finalize",a,function(){g?alert("one or more errors occured during the install"):($(".container").addClass("fadeout"),window.location="admin")},l)},l)},l)},l)})})},l=function(a){g=!0;var b=document.createElement("div");$(b).css("color","red"),$(b).html(a),$(".install-pro").append(b),$(".running .prev-step").fadeIn("fast")},m=function(a){var b={};a.find("input,select").each(function(){"checkbox"==$(this).attr("type")?b[$(this).data("name")]=$(this).is(":checked"):b[$(this).data("name")]=$(this).val()});return b},n=function(a,b,c,d){var e=document.createElement("div");$(e).html(a),$(".install-pro").append(e);var f=Ajax.getData(b,c);Ajax.dataResult(f,function(a){var b=document.createElement("div");$(b).html(a.message),$(".install-pro").append(b),d()},function(a){l(a)})},o=function(){c.on("click",h),d.on("click",i),e.on("click",j),f.on("click",k)},p=function(){o()};return{init:p}}(),ajaxpath="/",show_log=!0;!function(a){a.logThis=function(a){show_log&&void 0!==window.console&&console.log(a)}}(jQuery),$(document).ready(function(){Ajax.init(),"undefined"!=typeof $("body.install").html()&&Install.init(),"undefined"!=typeof $("body.admin").html()&&Admin.init()});